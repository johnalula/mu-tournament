<?php

/**
 * TeamGroupMemberParticipantTable
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class TeamGroupMemberParticipantTable extends PluginTeamGroupMemberParticipantTable
{
    /**
     * Returns an instance of this class.
     *
     * @return object TeamGroupMemberParticipantTable
     */
    public static function getInstance()
    {
        return Doctrine_Core::getTable('TeamGroupMemberParticipant');
    }
    //
   public static function processNew ( $_orgID, $_orgTokenID, $_teamGroupID, $_teamGroupTokenID, $_teamGroupMemberID, $_teamGroupMemberTokenID, $_memberPartcipantID, $_memberPartcipantTokenID, $_memberTeamName, $_memberParticipantName, $_memberParticipantRoleID, $_entryDate, $_participantStatus, $_description, $_userID, $_userTokenID)
	{
			$_groupMemberTeamParticipant = self::processSave ( $_teamGroupID, $_teamGroupTokenID, $_teamGroupMemberID, $_teamGroupMemberTokenID, $_memberPartcipantID, $_memberPartcipantTokenID, $_memberTeamName, $_memberParticipantName, $_memberParticipantRoleID, $_entryDate, $_participantStatus, $_description );
		
		return $_groupMemberTeamParticipant;
	}
	//
	public static function processCreate ( )
	{
		
	} 
	public static function processSave ( $_teamGroupID, $_teamGroupTokenID, $_teamGroupMemberID, $_teamGroupMemberTokenID, $_memberPartcipantID, $_memberPartcipantTokenID, $_memberTeamName, $_memberParticipantName, $_memberParticipantRoleID, $_entryDate, $_participantStatus, $_description )
	{
		//try {
			//if(!$_orgID || !$_name) return false;
    
			$_token = trim($_teamGroupID).trim($_teamGroupMemberID).trim($_teamGroupTokenID).rand('11111', '99999'); 
			$_startDate = date('m/d/Y', time());
			$_nw = new TeamGroupMemberParticipant (); 
			$_nw->token_id = sha1(md5(trim($_token))); 
			$_nw->sport_game_group_id = trim($_teamGroupID); 
			$_nw->sport_game_group_token_id = sha1(md5(trim($_teamGroupTokenID))); 
			$_nw->group_member_team_id = trim($_teamGroupMemberID); 
			$_nw->group_member_team_token_id = sha1(md5(trim($_teamGroupMemberTokenID))); 
			$_nw->team_member_participant_id = trim($_memberPartcipantID); 
			$_nw->team_member_participant_token_id = sha1(md5(trim($_memberPartcipantTokenID))); 
			$_nw->member_role_id = trim($_memberParticipantRoleID);  
			$_nw->start_date = $_entryDate ? trim($_entryDate):trim($_startDate);
			$_nw->active_flag = false;  
			$_nw->status = $_participantStatus ? trim($_participantStatus):TournamentCore::$_CONFIRMED;   
			$_nw->description = SystemCore::processDescription ( (trim($_memberParticipantName).' - '.trim(TournamentCore::processGenderValue($_memberTeamName))), trim($_description) );
			$_nw->save(); 
			
			return $_nw; 
		//} catch ( Exception $e) {
	    //  return false; 
		//}
	} 
	public static function processEdit ( )
	{
		
	} 
	//
	public static function processUpdate ( )
	{
		   
	} 
	//
	public static function processDelete( ) 
   {	
		 
	}
	//
	public static function appendPartialQueryFields ( ) 
	{		
		 
	}
	//
	public static function appendCandidateQueryFields ( ) 
	{		
		 
	}
	public static function appendQueryFields ( ) 
	{		
		 $_queryFileds = "tmGrpMbrPrt.id, tmGrpMbrPrt.active_flag as activeFlag,
		 
								gmGrpMbr.id, 
								tmMbrPrt.id, 
								gmGrp.id, gmGrp.group_name as sportGameGroupName, gmGrp.group_code as sportGameGroupCode, gmGrp.contestant_team_mode as contestantTeamMode, gmGrp.active_flag as groupActiveFlag, gmGrp.gender_category_id as groupGenderCategoryID, gmGrp.start_date as matchDate,
								sprtGm.id as sportGameID, sprtGm.token_id as sportGameTokenID,sprtGm.sport_game_category_id as matchSportGameCategoryID, 
								gmCat.id as gameCategoryID, gmCat.token_id as gameCategoryTokenID, gmCat.category_name as gameCategoryName, gmCat.alias as gameCategoryAlias,
								trnmt.id as tournamentID, trnmt.token_id as tournamentTokenID, trnmt.name as tournamentName, trnmt.alias as tournamentAlias,
								grpTyp.id as groupTypeID,
								tmPrt.team_name as teamName, tmPrt.alias as teamAlias, tmPrt.country_id as teamCountry, tmPrt.team_city as teamCity, tmPrt.team_number as teamNumber, tmPrt.confirm_flag as confirmFlag,
								org.id, 
								prsn.id as personID, prsn.name as memberName, prsn.middle_name as memberMiddleName, prsn.last_name as memberLastName, prsn.full_name as memberFullName,
								
							 
		";	
		return $_queryFileds;
	}
	//
  // process list selection function 
   public static function processSelection ( $_orgID=null, $_orgTokenID=null, $_tournamentID=null, $_teamGroupID=null, $_teamGroupTokenID=null, $_sportGameID=null, $_genderCategoryID=null, $_keyword=null, $_offset=0, $_limit=10 ) 
   {
		$_qry = Doctrine_Query::create()
				->select(self::appendQueryFields())
				->from("TeamGroupMemberParticipant tmGrpMbrPrt") 
				->innerJoin("tmGrpMbrPrt.SportGameTeamGroup gmGrpMbr on tmGrpMbrPrt.group_member_team_id = gmGrpMbr.id ") 
				->innerJoin("tmGrpMbrPrt.TeamMemberParticipant tmMbrPrt on tmGrpMbrPrt.team_member_participant_id = tmMbrPrt.id ") 
				->innerJoin("tmMbrPrt.Person prsn on tmMbrPrt.person_id = prsn.id ")  
				->innerJoin("gmGrpMbr.SportGameGroup gmGrp on gmGrpMbr.sport_game_group_id = gmGrp.id ") 
				->innerJoin("gmGrpMbr.Team tmPrt on gmGrpMbr.team_id = tmPrt.id ") 
				->innerJoin("gmGrp.Tournament trnmt on gmGrp.tournament_id = trnmt.id ")  
				->innerJoin("gmGrp.GameGroupType grpTyp on gmGrp.game_group_type_id = grpTyp.id ")  
				->innerJoin("gmGrp.SportGame sprtGm on gmGrp.sport_game_id = sprtGm.id ") 
				->innerJoin("sprtGm.GameCategory gmCat on sprtGm.sport_game_category_id = gmCat.id ")  
				->innerJoin("trnmt.Organization org on trnmt.org_id = org.id ")  
				->offset($_offset)
				->limit($_limit) 
				->orderBy("tmGrpMbrPrt.id DESC")
				->where("tmGrpMbrPrt.id IS NOT NULL");
				if(!is_null($_orgID)) $_qry = $_qry->addWhere("trnmt.org_id = ? AND trnmt.org_token_id = ? ", array($_orgID, $_orgTokenID));
				if(!is_null($_teamGroupID)) $_qry = $_qry->addWhere("gmGrp.id = ? AND gmGrp.token_id = ? ", array($_teamGroupID, $_teamGroupTokenID));
				if(!is_null($_tournamentID)) $_qry = $_qry->addWhere("gmGrp.active_flag = ?", $_tournamentID);    
				if(!is_null($_sportGameID)) $_qry = $_qry->addWhere("gmGrp.sport_game_id = ?", $_sportGameID);    
				if(!is_null($_genderCategoryID)) $_qry = $_qry->addWhere("gmGrp.gender_category_id = ?", $_genderCategoryID);    
				if(!is_null($_keyword) )
					if(strcmp(trim($_keyword), "") != 0 )
						$_qry = $_qry->andWhere("gmGrp.group_name LIKE ? OR sprtGm.name LIKE ? OR gmGrp.description LIKE ?", array( $_keyword, $_keyword, $_keyword));
				
			$_qry = $_qry->execute(array(), Doctrine_Core::HYDRATE_RECORD); 

		return ( count($_qry) <= 0 ? null:$_qry );  
	}
	//
   public static function processAll ( $_orgID=null, $_orgTokenID=null, $_tournamentID=null, $_gameTypeID=null, $_genderCategoryID=null, $_groupID=null, $_keyword=null ) 
   {
		$_qry = Doctrine_Query::create()
				->select(self::appendQueryFields())
				->from("TeamGroupMemberParticipant tmGrpMbrPrt") 
				->innerJoin("tmGrpMbrPrt.SportGameTeamGroup gmGrpMbr on tmGrpMbrPrt.group_member_team_id = gmGrpMbr.id ") 
				->innerJoin("tmGrpMbrPrt.TeamMemberParticipant tmMbrPrt on tmGrpMbrPrt.team_member_participant_id = tmMbrPrt.id ") 
				->innerJoin("tmMbrPrt.Person prsn on tmMbrPrt.person_id = prsn.id ")  
				->innerJoin("gmGrpMbr.SportGameGroup gmGrp on gmGrpMbr.sport_game_group_id = gmGrp.id ") 
				->innerJoin("gmGrpMbr.Team tmPrt on gmGrpMbr.team_id = tmPrt.id ") 
				->innerJoin("gmGrp.Tournament trnmt on gmGrp.tournament_id = trnmt.id ")  
				->innerJoin("gmGrp.GameGroupType grpTyp on gmGrp.game_group_type_id = grpTyp.id ")  
				->innerJoin("gmGrp.SportGame sprtGm on gmGrp.sport_game_id = sprtGm.id ") 
				->innerJoin("sprtGm.GameCategory gmCat on sprtGm.sport_game_category_id = gmCat.id ")  
				->innerJoin("trnmt.Organization org on trnmt.org_id = org.id ")  
				->orderBy("tmGrpMbrPrt.id DESC")
				->where("tmGrpMbrPrt.id IS NOT NULL");
				if(!is_null($_orgID)) $_qry = $_qry->addWhere("trnmt.org_id = ? AND trnmt.org_token_id = ? ", array($_orgID, $_orgTokenID));
				if(!is_null($_tournamentID)) $_qry = $_qry->addWhere("gmGrp.active_flag = ?", $_tournamentID);    
				if(!is_null($_gameTypeID)) $_qry = $_qry->addWhere("gmGrp.sport_game_id = ?", $_gameTypeID);    
				if(!is_null($_genderCategoryID)) $_qry = $_qry->addWhere("gmGrp.gender_category_id = ?", $_genderCategoryID);    
				if(!is_null($_groupID)) $_qry = $_qry->addWhere("gmGrp.game_group_type_id = ?", $_groupID);    
				if(!is_null($_keyword) )
					if(strcmp(trim($_keyword), "") != 0 )
						$_qry = $_qry->andWhere("gmGrp.group_name LIKE ? OR sprtGm.name LIKE ? OR gmGrp.description LIKE ?", array( $_keyword, $_keyword, $_keyword));
				
			$_qry = $_qry->execute(array(), Doctrine_Core::HYDRATE_RECORD); 

		return ( count($_qry) <= 0 ? null:$_qry );  


		return ( count($_qry) <= 0 ? null:$_qry );  
	}
	//
   public static function processCandidates (  $_orgID=null, $_orgTokenID=null, $_tournamentID=null, $_gameTypeID=null, $_genderCategoryID=null, $_groupID=null, $_keyword=null ) 
   {
		$_qry = Doctrine_Query::create()
				->select(self::appendQueryFields())
				->from("TeamGroupMemberParticipant gmGrpMbr") 
				->innerJoin("gmGrpMbr.SportGameGroup gmGrp on gmGrpMbr.sport_game_group_id = gmGrp.id ") 
				->innerJoin("gmGrpMbr.Team tmPrt on gmGrpMbr.team_id = tmPrt.id ") 
				->innerJoin("gmGrp.Tournament trnmt on gmGrp.tournament_id = trnmt.id ")  
				->innerJoin("gmGrp.GameGroupType grpTyp on gmGrp.game_group_type_id = grpTyp.id ")  
				->innerJoin("gmGrp.SportGame sprtGm on gmGrp.sport_game_id = sprtGm.id ") 
				->innerJoin("sprtGm.GameCategory gmCat on sprtGm.sport_game_category_id = gmCat.id ")  
				->innerJoin("trnmt.Organization org on trnmt.org_id = org.id ")   
				->orderBy("gmGrp.id ASC")
				->where("gmGrp.id IS NOT NULL");
				if(!is_null($_orgID)) $_qry = $_qry->addWhere("trnmt.org_id = ? AND trnmt.org_token_id = ? ", array($_orgID, $_orgTokenID));
				if(!is_null($_tournamentID)) $_qry = $_qry->addWhere("gmGrp.active_flag = ?", $_tournamentID);    
				if(!is_null($_gameTypeID)) $_qry = $_qry->addWhere("gmGrp.sport_game_id = ?", $_gameTypeID);    
				if(!is_null($_genderCategoryID)) $_qry = $_qry->addWhere("gmGrp.gender_category_id = ?", $_genderCategoryID);    
				if(!is_null($_groupID)) $_qry = $_qry->addWhere("gmGrp.game_group_type_id = ?", $_groupID);    
				if(!is_null($_keyword) )
					if(strcmp(trim($_keyword), "") != 0 )
						$_qry = $_qry->andWhere("gmGrp.group_name LIKE ? OR sprtGm.name LIKE ? OR gmGrp.description LIKE ?", array( $_keyword, $_keyword, $_keyword));
				
			$_qry = $_qry->execute(array(), Doctrine_Core::HYDRATE_RECORD); 


		return ( count($_qry) <= 0 ? null:$_qry );  
		 
	}
	public static function processCandidateParticipants ( $_orgID=null, $_tournamentID=null, $_teamGroupID=null, $_teamID=null, $_teamTokenID=null, $_sportGameID=null, $_genderCategoryID=null, $_groupID=null, $_keyword=null ) 
   {
		$_qry = Doctrine_Query::create()
				->select(self::appendQueryFields())
				->from("TeamGroupMemberParticipant tmGrpMbrPrt") 
				->innerJoin("tmGrpMbrPrt.SportGameTeamGroup gmGrpMbr on tmGrpMbrPrt.group_member_team_id = gmGrpMbr.id ") 
				->innerJoin("tmGrpMbrPrt.TeamMemberParticipant tmMbrPrt on tmGrpMbrPrt.team_member_participant_id = tmMbrPrt.id ") 
				->innerJoin("tmMbrPrt.Person prsn on tmMbrPrt.person_id = prsn.id ")  
				->innerJoin("gmGrpMbr.SportGameGroup gmGrp on gmGrpMbr.sport_game_group_id = gmGrp.id ") 
				->innerJoin("gmGrpMbr.Team tmPrt on gmGrpMbr.team_id = tmPrt.id ") 
				->innerJoin("gmGrp.Tournament trnmt on gmGrp.tournament_id = trnmt.id ")  
				->innerJoin("gmGrp.GameGroupType grpTyp on gmGrp.game_group_type_id = grpTyp.id ")  
				->innerJoin("gmGrp.SportGame sprtGm on gmGrp.sport_game_id = sprtGm.id ") 
				->innerJoin("sprtGm.GameCategory gmCat on sprtGm.sport_game_category_id = gmCat.id ")  
				->innerJoin("trnmt.Organization org on trnmt.org_id = org.id ")  
				->orderBy("tmGrpMbrPrt.id DESC")
				->where("tmGrpMbrPrt.id IS NOT NULL");
				if(!is_null($_orgID)) $_qry = $_qry->addWhere("tmPrt.id = ? AND tmPrt.token_id = ? ", array($_teamID, $_teamTokenID));
				if(!is_null($_teamGroupID)) $_qry = $_qry->addWhere("gmGrp.id = ?", $_teamGroupID);    
				if(!is_null($_sportGameID)) $_qry = $_qry->addWhere("sprtGm.id = ?", $_sportGameID);    
				if(!is_null($_tournamentID)) $_qry = $_qry->addWhere("trnmt.id = ?", $_tournamentID);    
				if(!is_null($_genderCategoryID)) $_qry = $_qry->addWhere("gmGrp.gender_category_id = ?", $_genderCategoryID);    
				if(!is_null($_groupID)) $_qry = $_qry->addWhere("gmGrp.game_group_type_id = ?", $_groupID);     
				if(! is_null($_exclusion)) $_qry = $_qry->andWhereNotIn("tmGrpMbrPrt.id ", $_exclusion );          
				if(!is_null($_keyword) )
					if(strcmp(trim($_keyword), "") != 0 )
						$_qry = $_qry->andWhere("gmGrp.group_name LIKE ? OR sprtGm.name LIKE ? OR gmGrp.description LIKE ?", array( $_keyword, $_keyword, $_keyword));
				
			$_qry = $_qry->execute(array(), Doctrine_Core::HYDRATE_RECORD); 

		return ( count($_qry) <= 0 ? null:$_qry );  


		return ( count($_qry) <= 0 ? null:$_qry );  
	}
	//
	public static function processObject ( $_orgID=null, $_orgTokenID=null, $_teamGroupID, $_tokenID ) 
	{
		$_qry = Doctrine_Query::create()
				->select(self::appendQueryFields())
				->from("TeamGroupMemberParticipant tmGrpMbrPrt") 
				->innerJoin("tmGrpMbrPrt.SportGameTeamGroup gmGrpMbr on tmGrpMbrPrt.group_member_team_id = gmGrpMbr.id ") 
				->innerJoin("tmGrpMbrPrt.TeamMemberParticipant tmMbrPrt on tmGrpMbrPrt.team_member_participant_id = tmMbrPrt.id ") 
				->innerJoin("tmMbrPrt.Person prsn on tmMbrPrt.person_id = prsn.id ")  
				->innerJoin("gmGrpMbr.SportGameGroup gmGrp on gmGrpMbr.sport_game_group_id = gmGrp.id ") 
				->innerJoin("gmGrpMbr.Team tmPrt on gmGrpMbr.team_id = tmPrt.id ") 
				->innerJoin("gmGrp.Tournament trnmt on gmGrp.tournament_id = trnmt.id ")  
				->innerJoin("gmGrp.GameGroupType grpTyp on gmGrp.game_group_type_id = grpTyp.id ")  
				->innerJoin("gmGrp.SportGame sprtGm on gmGrp.sport_game_id = sprtGm.id ") 
				->innerJoin("sprtGm.GameCategory gmCat on sprtGm.sport_game_category_id = gmCat.id ")  
				->innerJoin("trnmt.Organization org on trnmt.org_id = org.id ")      
				->where("gmGrp.id = ? AND gmGrp.token_id = ? ", array($_teamGroupID, $_tokenID ));
				if(!is_null($_orgID)) $_qry = $_qry->andWhere("trnmt.org_id = ? AND trnmt.org_token_id = ?", array($_orgID, $_orgTokenID));
				$_qry = $_qry->fetchOne(array(), Doctrine_Core::HYDRATE_RECORD); 
			
		return (! $_qry ? null : $_qry ); 	
	}  
	//
   public static function makeObject ( $_orgID=null, $_matchID, $_tokenID  ) 
	{
		$_qry = Doctrine_Query::create()
				->select(self::appendQueryFields())
				->from("TeamGroupMemberParticipant gmGrp") 
				->innerJoin("gmGrp.Tournament trnmt on gmGrp.tournament_id = trnmt.id ") 
				->innerJoin("gmGrp.GameGroupType grpTyp on gmGrp.game_group_type_id = grpTyp.id ")  
				->innerJoin("gmGrp.SportGame sprtGm on gmGrp.sport_game_id = sprtGm.id ") 
				->innerJoin("sprtGm.GameCategory gmCat on sprtGm.sport_game_category_id = gmCat.id ")  
				->innerJoin("trnmt.Organization org on trnmt.org_id = org.id ")     
				->where("gmGrp.id = ? AND gmGrp.token_id = ? ", array($_matchID, $_tokenID ));
				//if(!is_null($_orgID)) $_qry = $_qry->andWhere("prt.org_id = ? AND prt.org_token_id = ?", array($_orgID, $_orgTokenID));
				$_qry = $_qry->fetchOne(array(), Doctrine_Core::HYDRATE_RECORD); 
			
		return (! $_qry ? null : $_qry ); 	
	}  
	//
   public static function makeCandidateObject ( $_orgID=null, $_activeFlag ) 
	{
		$_qry = Doctrine_Query::create()
				->select(self::appendQueryFields())
				->from("TeamGroupMemberParticipant gmGrp") 
				->innerJoin("gmGrp.Tournament trnmt on gmGrp.tournament_id = trnmt.id ") 
				->innerJoin("gmGrp.GameGroupType grpTyp on gmGrp.game_group_type_id = grpTyp.id ")  
				->innerJoin("gmGrp.SportGame sprtGm on gmGrp.sport_game_id = sprtGm.id ") 
				->innerJoin("sprtGm.GameCategory gmCat on sprtGm.sport_game_category_id = gmCat.id ")  
				->innerJoin("trnmt.Organization org on trnmt.org_id = org.id ")     
				->where("gmGrp.id IS NOT NULL");
				//if(!is_null($_orgID)) $_qry = $_qry->andWhere("prt.org_id = ? AND prt.org_token_id = ?", array($_orgID, $_orgTokenID));
				if(!is_null($_activeFlag)) $_qry = $_qry->andWhere("gmGrp.active_flag = ?", $_activeFlag);
				$_qry = $_qry->fetchOne(array(), Doctrine_Core::HYDRATE_RECORD); 
			
		return (! $_qry ? null : $_qry ); 	
	}  
	 
	
	/*********************************************************
	********** Candidate selection process *******************
	**********************************************************/
	
	//
	public static function processCandidatePersonSelection ( ) 
   { 
		
	}  
	
	/*********************************************************
	********** Candidate filtering process *******************
	**********************************************************/
	
	public static function processRoleSelection ()
	{
		 
	}
}
